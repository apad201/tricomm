---
title: "working"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(broom)
data = read.csv("data/stepsSleep.csv")
getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}
```

## R Markdown

```{r}
glimpse(data)
```



```{r}
varNames = names(data)
stepsObsByTime <- tibble(Student.ID = integer(), date = character(), time = character(), steps = integer(), asleep = integer())
for(i in 3:98) {
  for(j in 1:3100) {
    stepsObsByTime <- stepsObsByTime %>% 
      add_row(Student.ID = data[j,1],
              date = data[j,2],
              time = varNames[i],
              steps = data[j,i],
              asleep = data[j,i+96])
  }
}
```

```{r}
stepsObsByTime <- stepsObsByTime %>%
  mutate(time = substr(time, 2,8)) %>%
  mutate(time = as.numeric(time)) %>%
  mutate(timeOfDay = case_when(
    time < 8.0 ~ "earlyAM",
    time >= 8.0 & time < 12.0 ~ "lateAM",
    time >= 12.0 & time < 20.0 ~ "earlyPM",
    time >= 20.0 ~ "latePM"
  )) %>%
  mutate(timeOfDay = as.factor(timeOfDay)) %>%
  mutate(timeFrom2 = case_when(
    abs(time - 2) < abs(time - 26) ~ abs(time - 2),
    abs(time - 2) >= abs(time - 26) ~ abs(time - 26)
  ))
```

```{r}
logit_mod <- glm(asleep ~ timeFrom2 + steps, data = stepsObs2, family = binomial)
tidy(logit_mod)
summary(logit_mod)
```

```{r}
log_odds <- augment(logit_mod, newdata = stepsObs2) %>%
  mutate(odds = exp(.fitted)) %>%
  mutate(pred_prob = odds / (1 + odds)) %>%
  mutate(pred = case_when(
    pred_prob <= 0.5 ~ 0,
    pred_prob > 0.5 ~ 1
  ))
```





```{r}
stepsObsMN <- stepsObsByTime %>%
  filter(time == 0.00) %>%
  group_by(Student.ID) %>%
  summarize(steps = mean(steps), asleep = getmode(asleep), timeOfDay = getmode(timeOfDay), time = getmode(time))

```

```{r}
mn_model <- glm(asleep ~ steps, data = stepsObsMN, family = binomial)
tidy(mn_model)
summary(mn_model)
stepsObsMNPred <- augment(mn_model, newdata = stepsObsMN) %>%
  mutate(odds = exp(.fitted)) %>%
  mutate(pred_prob = odds / (1 + odds)) %>%
  mutate(pred = case_when(
    pred_prob <= 0.5 ~ 0,
    pred_prob > 0.5 ~ 1
  ))
```
